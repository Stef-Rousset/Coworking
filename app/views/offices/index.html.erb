<div class="offices-title">
  <h2>Liste des bureaux "<%= @building.name %>"</h2>
  <% if current_user.admin? %>
    <div class="offices-title__links">
      <%= link_to "Ajouter un bureau", new_building_office_path(@building), class: "btn btn-secondary" %>
      <%= link_to "Back to dashboard", dashboard_path, class: 'btn btn-secondary' %>
    </div>
  <% end %>
</div>
<div class="offices-details">
  <% @offices.each do |office| %>
    <div class="office-card">
      <div class="office-card__title">
        <h3 class="office-card__title<%= office.id %>"><%= office.name.capitalize %></h3>
          <% if !office.discounts.empty? %>
            <!-- Modal -->
              <%= render 'modal-discounts', office: office %>
            <!-- end Modal -->
        <% end %>
      </div>
      <div class="office-card__text">
        <p><%= office.places_number %> place(s)</p>
        <% if current_user.admin? %>
          <p><%= rounded_number(office.price, 1) %><i class="fas fa-euro-sign"></i>/min</p>
        <% else %>
          <p><%= rounded_number(office.price, 60) %><i class="fas fa-euro-sign"></i>/h</p>
        <% end %>
      </div>
      <% if !current_user.admin? %>
        <%= link_to 'Réserver', office_path(office), class: 'btn btn-secondary' %>
      <% end %>
      <% if current_user.admin? %>
        <div class="office-card__links">
          <%= link_to '<i class="far fa-edit"></i>'.html_safe,  edit_office_path(office) %>
          <%= link_to '<i class="far fa-trash-alt"></i>'.html_safe, office_path(office),
              method: :delete, data: { confirm: "Are you sure" } %>
        </div>
        <div class="office-card__form">
          <h4 class="add_discount" data-number="<%= office.id %>">Ajouter une réduction ▽</h4>
          <div class="discount-form hide-discount-form" data-number="<%= office.id %>">
            <%= simple_form_for([office, @discount], remote: true) do |f| %>
              <%= f.input :amount, :label => "Montant" %>
              <%= f.input :start_date, as: :date %>
              <%= f.input :end_date, as: :date %>
              <%= f.submit "Valider", class: 'btn btn-secondary' %>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  <% end %>
</div>
<script>
  let linksToDiscountForm = document.querySelectorAll('.add_discount');
  const forms = document.querySelectorAll('.discount-form');
  linksToDiscountForm.forEach( linkToDiscountForm => {
      linkToDiscountForm.addEventListener('click', event => {
          if (linkToDiscountForm.innerText === 'Ajouter une réduction ▽') {
            linkToDiscountForm.innerText = 'Ajouter une réduction △';
          } else if (linkToDiscountForm.innerText === 'Ajouter une réduction △'){
            linkToDiscountForm.innerText = 'Ajouter une réduction ▽';
          }
          forms.forEach(form => {
            if (form.dataset.number === event.currentTarget.dataset.number){;
              form.classList.toggle('hide-discount-form');
              form.classList.toggle('show-discount-form');
            }
          });
      })
  })

</script>

